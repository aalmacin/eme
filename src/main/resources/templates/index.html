<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Eme - Language translator and audio</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">

    <!-- Include Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
        }

        h1, h2, h3, h4 {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 600;
        }

        .card {
            border: none;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .card-header {
            background-color: #ffffff;
            border-bottom: none;
        }

        .card-body {
            background-color: #ffffff;
        }

        .card-title {
            margin-bottom: 0;
        }

        .anki-placeholder-info {
            font-size: 0.9rem;
            background: #e9ecef;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .nav-links {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .nav-links a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .nav-links a:hover {
            background-color: #e9ecef;
        }
    </style>
</head>

<body>
<div class="container mt-5" id="app">
    <h1 class="mb-4">Eme</h1>
    
    <div class="nav-links">
        <a href="/words">üìñ Words Library</a>
        <a href="/translations">üìö Manage Translations</a>
        <a href="/sentences">üìù Manage Sentences</a>
        <a href="/character-guide">üé≠ Character Guide</a>
        <a href="/sessions">üì¶ Translation Sessions</a>
        <a href="/presets">‚öôÔ∏è Manage Presets</a>
        <a href="/anki-formats">üé¥ Anki Card Formats</a>
    </div>

    <div th:if="${not #lists.isEmpty(errors)}" class="alert alert-danger">
        <h4>Error:</h4>
        <ul>
            <li th:each="error : ${errors}" th:text="${error}" class="mb-1"></li>
        </ul>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <form th:action="@{/generate/review}" method="post">

                <!-- Card: Source Text -->
                <div class="card shadow mb-3">
                    <div class="card-header">
                        <h2 class="card-title h5">Enter Source Text</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="text" class="form-label">Words or Phrases:</label>
                            <p class="small text-muted">Enter one word or phrase per line</p>
                            <textarea class="form-control" id="text" name="text" rows="5" placeholder="Example:&#10;‡§®‡§Æ‡§∏‡•ç‡§§‡•á&#10;‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶&#10;‡§Ü‡§™ ‡§ï‡•à‡§∏‡•á ‡§π‡•à‡§Ç?" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lang" class="form-label">Source Language:</label>
                                <select class="form-select" id="lang" name="lang" v-model="sourceLang">
                                    <option value="hi">Hindi</option>
                                    <option value="pa">Punjabi</option>
                                    <option value="jp">Japanese</option>
                                    <option value="kr">Korean</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="cafr">Canadian French</option>
                                    <option value="tl">Tagalog</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="target-lang" class="form-label">Target Language:</label>
                                <select class="form-select" id="target-lang" name="target-lang" v-model="targetLang">
                                    <option value="en">English</option>
                                    <option value="hi">Hindi</option>
                                    <option value="pa">Punjabi</option>
                                    <option value="jp">Japanese</option>
                                    <option value="kr">Korean</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="tl">Tagalog</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card: Features to Generate -->
                <div class="card shadow mb-4">
                    <div class="card-header">
                        <h2 class="card-title h5">Choose What to Generate</h2>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check p-3 border rounded" style="background-color: #f8f9fa;">
                                    <input type="checkbox" class="form-check-input" id="feature-translation" v-model="enableTranslation" @change="updateFeatureFlags">
                                    <label class="form-check-label" for="feature-translation">
                                        <strong>‚úì Translation & Transliteration</strong>
                                        <div class="small text-muted">Translate words and add transliteration</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check p-3 border rounded" :style="{ backgroundColor: enableTranslation ? '#f8f9fa' : '#e9ecef', opacity: enableTranslation ? 1 : 0.6, pointerEvents: enableTranslation ? 'auto' : 'none' }">
                                    <input type="checkbox" class="form-check-input" id="feature-mnemonics"
                                           v-model="enableMnemonics"
                                           @change="updateFeatureFlags"
                                           :disabled="!enableTranslation"
                                           @click="!enableTranslation && $event.preventDefault()">
                                    <label class="form-check-label" for="feature-mnemonics">
                                        <strong>‚úì Mnemonics & Images</strong>
                                        <div class="small text-muted">Generate memory aids with visual imagery</div>
                                        <div v-if="!enableTranslation" class="small text-warning mt-1">Requires Translation</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check p-3 border rounded" style="background-color: #f8f9fa;">
                                    <input type="checkbox" class="form-check-input" id="feature-audio" v-model="enableAudio" @change="updateFeatureFlags">
                                    <label class="form-check-label" for="feature-audio">
                                        <strong>‚úì Audio</strong>
                                        <div class="small text-muted">Generate pronunciation audio files</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check p-3 border rounded" :style="{ backgroundColor: enableTranslation ? '#f8f9fa' : '#e9ecef', opacity: enableTranslation ? 1 : 0.6, pointerEvents: enableTranslation ? 'auto' : 'none' }">
                                    <input type="checkbox" class="form-check-input" id="feature-sentences"
                                           v-model="enableSentences"
                                           @change="updateFeatureFlags"
                                           :disabled="!enableTranslation"
                                           @click="!enableTranslation && $event.preventDefault()">
                                    <label class="form-check-label" for="feature-sentences">
                                        <strong>‚úì Example Sentences</strong>
                                        <div class="small text-muted">Generate example sentences with structure</div>
                                        <div v-if="!enableTranslation" class="small text-warning mt-1">Requires Translation</div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Options (Collapsible) -->
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-link text-decoration-none p-0" @click="showAdvanced = !showAdvanced">
                                {{ showAdvanced ? '‚ñº' : '‚ñ∂' }} Advanced Options
                            </button>
                        </div>

                        <div v-show="showAdvanced" class="mt-3 p-3 border rounded" style="background-color: #fff;">
                            <div class="mb-3" v-show="enableMnemonics">
                                <label for="image-style" class="form-label">Image Style:</label>
                                <select class="form-select" id="image-style" name="image-style" v-model="imageStyle">
                                    <option value="REALISTIC_CINEMATIC">Realistic Cinematic</option>
                                    <option value="ANIMATED_2D_CINEMATIC">2D Animated Cinematic</option>
                                    <option value="ANIMATED_3D_CINEMATIC">3D Animated Cinematic</option>
                                </select>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="override-translation" name="override-translation" v-model="overrideTranslation">
                                <label class="form-check-label" for="override-translation">
                                    Override Translation Cache
                                    <div class="form-text">Force new translation instead of using cached translations</div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden form fields for backend compatibility -->
                <input type="hidden" id="translation" name="translation" :value="translation ? 'on' : ''">
                <input type="hidden" id="source-audio" name="source-audio" :value="sourceAudio ? 'on' : ''">
                <input type="hidden" id="target-audio" name="target-audio" :value="targetAudio ? 'on' : ''">
                <input type="hidden" id="sentence-generation" name="sentence-generation" :value="sentenceGeneration ? 'on' : ''">
                <input type="hidden" id="image-generation" name="image-generation" :value="imageGeneration ? 'on' : ''">

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-lg w-100 mb-5">
                    Generate Session ‚Üí
                </button>
            </form>
        </div>
    </div>

</div>

<!-- jQuery and Bootstrap Bundle JS -->
<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}" type="application/javascript"></script>
<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}" type="application/javascript"></script>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            // Simplified feature toggles
            enableTranslation: true,
            enableMnemonics: false,
            enableAudio: false,
            enableSentences: false,
            showAdvanced: false,

            // Underlying feature flags (for backend)
            targetAudio: false,
            sourceAudio: false,
            translation: true,
            overrideTranslation: false,
            sentenceGeneration: false,
            imageGeneration: false,
            imageStyle: 'REALISTIC_CINEMATIC',
            sourceLang: 'hi',
            targetLang: 'en'
        },
        mounted: function() {
            this.updateFeatureFlags(); // Initialize feature flags
        },
        watch: {
            // Watch enableTranslation and immediately disable dependent features
            enableTranslation: function(newVal) {
                if (!newVal) {
                    this.enableMnemonics = false;
                    this.enableSentences = false;
                }
                this.updateFeatureFlags();
            }
        },
        methods: {
            updateFeatureFlags: function() {
                // Enforce dependencies - if translation is disabled, dependent features must be disabled
                if (!this.enableTranslation) {
                    this.enableMnemonics = false;
                    this.enableSentences = false;
                }

                // Update individual flags based on simplified feature toggles
                this.translation = this.enableTranslation;
                this.imageGeneration = this.enableMnemonics;
                this.sourceAudio = this.enableAudio;
                this.targetAudio = this.enableAudio && this.enableTranslation;
                this.sentenceGeneration = this.enableSentences;
            }
        }
    })
</script>
</body>
</html>
