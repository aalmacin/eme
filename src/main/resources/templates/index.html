<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Eme - Language translator and audio</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">

    <!-- Include Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
        }

        h1, h2, h3, h4 {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 600;
        }

        .card {
            border: none;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .card-header {
            background-color: #ffffff;
            border-bottom: none;
        }

        .card-body {
            background-color: #ffffff;
        }

        .card-title {
            margin-bottom: 0;
        }

        .anki-placeholder-info {
            font-size: 0.9rem;
            background: #e9ecef;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .nav-links {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .nav-links a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .nav-links a:hover {
            background-color: #e9ecef;
        }
    </style>
</head>

<body>
<div class="container mt-5" id="app">
    <h1 class="mb-4">Eme</h1>
    
    <div class="nav-links">
        <a href="/words">üìñ Words Library</a>
        <a href="/translations">üìö Manage Translations</a>
        <a href="/sentences">üìù Manage Sentences</a>
        <a href="/character-guide">üé≠ Character Guide</a>
        <a href="/sessions">üì¶ Translation Sessions</a>
        <a href="/presets">‚öôÔ∏è Manage Presets</a>
    </div>

    <div th:if="${not #lists.isEmpty(errors)}" class="alert alert-danger">
        <h4>Error:</h4>
        <ul>
            <li th:each="error : ${errors}" th:text="${error}" class="mb-1"></li>
        </ul>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <form th:action="@{/generate/review}" method="post">

                <!-- Card: Preset Selection -->
                <div class="card shadow mb-3">
                    <div class="card-header">
                        <h2 class="card-title h5">Preset Configuration</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="preset-selector" class="form-label">Load Preset:</label>
                            <select class="form-select" id="preset-selector" v-model="selectedPreset" @change="loadPreset">
                                <option value="">-- Select a preset --</option>
                                <option v-for="preset in presets" :key="preset.id" :value="preset.id" v-text="preset.presetName + (preset.isDefault ? ' (Default)' : '')"></option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-success" @click="showSavePresetModal">
                            üíæ Save Current Settings as Preset
                        </button>
                    </div>
                </div>

                <!-- Card: Source Text Options -->
                <div class="card shadow">
                    <div class="card-header">
                        <h2 class="card-title h5">Source Text Options</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="text" class="form-label">Enter text for source text:</label>
                            <p class="small">Each line is a text entry.</p>
                            <textarea class="form-control" id="text" name="text" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="lang" class="form-label">Select Source Language:</label>
                            <select class="form-select" id="lang" name="lang" v-model="sourceLang">
                                <option value="cafr">Canadian French</option>
                                <option value="jp">Japanese</option>
                                <option value="kr">Korean</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="en">English</option>
                                <option value="hi">Hindi</option>
                                <option value="pa">Punjabi</option>
                                <option value="tl">Tagalog</option>
                            </select>
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input" id="source-audio" name="source-audio" v-model="sourceAudio">
                            <label class="form-check-label" for="source-audio">Source Audio</label>
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input" id="sentence-generation" name="sentence-generation" v-model="sentenceGeneration">
                            <label class="form-check-label" for="sentence-generation">Generate Sentences</label>
                        </div>
                    </div>
                </div>

                <!-- Card: Translation Options -->
                <div class="card shadow" v-if="!translation || translation">
                    <div class="card-header">
                        <h2 class="card-title h5">Translation Options</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="translation" name="translation" v-model="translation">
                            <label class="form-check-label" for="translation">Translate</label>
                        </div>
                        <div v-if="translation">
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="override-translation" name="override-translation" v-model="overrideTranslation">
                                <label class="form-check-label" for="override-translation">Override Translation Cache</label>
                                <div class="form-text">Force new translation instead of using cached translations</div>
                            </div>
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="target-audio" name="target-audio" v-model="targetAudio">
                                <label class="form-check-label" for="target-audio">Target Audio</label>
                            </div>
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="image-generation" name="image-generation" v-model="imageGeneration">
                                <label class="form-check-label" for="image-generation">Generate Mnemonic Images</label>
                                <div class="form-text">Creates visual mnemonics using characters from your Character Guide</div>
                            </div>
                            <div class="mb-3" v-show="imageGeneration">
                                <label for="image-style" class="form-label">Image Style:</label>
                                <select class="form-select" id="image-style" name="image-style" v-model="imageStyle">
                                    <option value="REALISTIC_CINEMATIC">Realistic Cinematic</option>
                                    <option value="ANIMATED_2D_CINEMATIC">2D Animated Cinematic</option>
                                    <option value="ANIMATED_3D_CINEMATIC">3D Animated Cinematic</option>
                                </select>
                                <div class="form-text">Choose the artistic style for generated images</div>
                            </div>
                            <div class="mb-3">
                                <label for="target-lang" class="form-label">Select Target Language:</label>
                                <select class="form-select" id="target-lang" name="target-lang" v-model="targetLang">
                                    <option value="en">English</option>
                                    <option value="jp">Japanese</option>
                                    <option value="kr">Korean</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="hi">Hindi</option>
                                    <option value="pa">Punjabi</option>
                                    <option value="tl">Tagalog</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card: Anki Card Options -->
                <div class="card shadow">
                    <div class="card-header">
                        <h2 class="card-title h5">Anki Card Options</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-4">
                            <input type="checkbox" class="form-check-input" id="anki" name="anki" v-model="anki">
                            <label class="form-check-label" for="anki">Generate Anki Cards</label>
                        </div>

                        <!-- Show placeholders info if Anki is selected -->
                        <div class="anki-placeholder-info" v-if="anki">
                            <strong>Available placeholders:</strong>
                            <div>[source-text]</div>
                            <div>[source_transliteration]</div>
                            <div v-if="sourceAudio">[source-audio]</div>
                            <div v-if="translation">[target-text]</div>
                            <div v-if="translation && targetAudio">[target-audio]</div>
                            <div v-if="sentenceGeneration">[sentence-latin]</div>
                            <div v-if="sentenceGeneration">[sentence-target]</div>
                            <div v-if="sentenceGeneration">[sentence-transliteration]</div>
                            <div v-if="sentenceGeneration">[sentence-source]</div>
                            <div v-if="sentenceGeneration">[sentence-structure]</div>
                            <div v-if="sentenceGeneration">[sentence-source-audio]</div>
                            <div v-if="translation && imageGeneration" class="mt-2" style="border-top: 1px solid #ccc; padding-top: 0.5rem;">
                                <strong>Mnemonic Image placeholders:</strong>
                                <div>[image] - The generated image (available after download)</div>
                                <div>[mnemonic_keyword] - Memory keyword</div>
                                <div>[mnemonic_sentence] - Memory sentence</div>
                            </div>
                        </div>

                        <div v-if="anki">
                            <div class="mb-3">
                                <label for="deck" class="form-label">Deck:</label>
                                <input type="text" class="form-control" id="deck" name="deck" v-model="deck"/>
                            </div>
                            <div class="mb-3">
                                <label for="front" class="form-label">Front:</label>
                                <textarea class="form-control" id="front" name="front" rows="3" v-model="front"></textarea>
                                <div class="my-2">
                                    <a class="btn btn-secondary btn-sm m-1" href="#addFrontLineBreak" role="button"
                                       @click.prevent="addFrontLineBreak">
                                        Add line break
                                    </a>
                                    <a class="btn btn-secondary btn-sm m-1" href="#addFrontSourceText" role="button"
                                       @click.prevent="addFrontSourceText">
                                        Add source text
                                    </a>
                                    <a class="btn btn-secondary btn-sm m-1" href="#addFrontSourceTransliteration" role="button"
                                       @click.prevent="addFrontSourceTransliteration">
                                        Add source transliteration
                                    </a>
                                    <a v-if="translation" class="btn btn-secondary btn-sm m-1" href="#addFrontTargetText" role="button"
                                       @click.prevent="addFrontTargetText">
                                        Add translated target text
                                    </a>
                                    <a v-if="sourceAudio" class="btn btn-secondary btn-sm m-1" href="#addFrontSourceAudio" role="button"
                                       @click.prevent="addFrontSourceAudio">
                                        Add source audio
                                    </a>
                                    <a v-if="translation && targetAudio" class="btn btn-secondary btn-sm m-1" href="#addFrontTargetAudio"
                                       role="button" @click.prevent="addFrontTargetAudio">
                                        Add translated target audio
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceLatin"
                                       role="button" @click.prevent="addFrontSentenceLatin">
                                        Add sentence latin
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceTarget"
                                       role="button" @click.prevent="addFrontSentenceTarget">
                                        Add sentence target
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceTransliteration"
                                       role="button" @click.prevent="addFrontSentenceTransliteration">
                                        Add sentence transliteration
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceSource"
                                       role="button" @click.prevent="addFrontSentenceSource">
                                        Add sentence source
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceStructure"
                                       role="button" @click.prevent="addFrontSentenceStructure">
                                        Add sentence structure
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addFrontSentenceSourceAudio"
                                       role="button" @click.prevent="addFrontSentenceSourceAudio">
                                        Add sentence source audio
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addFrontImage"
                                       role="button" @click.prevent="addFrontImage">
                                        Add image
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addFrontMnemonicKeyword"
                                       role="button" @click.prevent="addFrontMnemonicKeyword">
                                        Add mnemonic keyword
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addFrontMnemonicSentence"
                                       role="button" @click.prevent="addFrontMnemonicSentence">
                                        Add mnemonic sentence
                                    </a>
                                </div>
                                <div class="mt-2" v-if="sentenceGeneration">
                                    <button type="button" class="btn btn-success btn-sm" @click="setOptimalHindiCard">
                                        üáÆüá≥ Optimal Hindi Card
                                    </button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="back" class="form-label">Back:</label>
                                <textarea class="form-control" id="back" name="back" rows="3" v-model="back"></textarea>
                                <div class="my-2">
                                    <a class="btn btn-secondary btn-sm m-1" href="#addBackLineBreak" role="button"
                                       @click.prevent="addBackLineBreak">
                                        Add line break
                                    </a>
                                    <a class="btn btn-secondary btn-sm m-1" href="#addBackSourceText" role="button"
                                       @click.prevent="addBackSourceText">
                                        Add source text
                                    </a>
                                    <a class="btn btn-secondary btn-sm m-1" href="#addBackSourceTransliteration" role="button"
                                       @click.prevent="addBackSourceTransliteration">
                                        Add source transliteration
                                    </a>
                                    <a v-if="translation" class="btn btn-secondary btn-sm m-1" href="#addBackTargetText" role="button"
                                       @click.prevent="addBackTargetText">
                                        Add translated target text
                                    </a>
                                    <a v-if="sourceAudio" class="btn btn-secondary btn-sm m-1" href="#addBackSourceAudio" role="button"
                                       @click.prevent="addBackSourceAudio">
                                        Add source audio
                                    </a>
                                    <a v-if="translation && targetAudio" class="btn btn-secondary btn-sm m-1" href="#addBackTargetAudio"
                                       role="button" @click.prevent="addBackTargetAudio">
                                        Add translated target audio
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceLatin"
                                       role="button" @click.prevent="addBackSentenceLatin">
                                        Add sentence latin
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceTarget"
                                       role="button" @click.prevent="addBackSentenceTarget">
                                        Add sentence target
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceTransliteration"
                                       role="button" @click.prevent="addBackSentenceTransliteration">
                                        Add sentence transliteration
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceSource"
                                       role="button" @click.prevent="addBackSentenceSource">
                                        Add sentence source
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceStructure"
                                       role="button" @click.prevent="addBackSentenceStructure">
                                        Add sentence structure
                                    </a>
                                    <a v-if="sentenceGeneration" class="btn btn-secondary btn-sm m-1" href="#addBackSentenceSourceAudio"
                                       role="button" @click.prevent="addBackSentenceSourceAudio">
                                        Add sentence source audio
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addBackImage"
                                       role="button" @click.prevent="addBackImage">
                                        Add image
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addBackMnemonicKeyword"
                                       role="button" @click.prevent="addBackMnemonicKeyword">
                                        Add mnemonic keyword
                                    </a>
                                    <a v-if="translation && imageGeneration" class="btn btn-warning btn-sm m-1" href="#addBackMnemonicSentence"
                                       role="button" @click.prevent="addBackMnemonicSentence">
                                        Add mnemonic sentence
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-lg w-100 mb-5">
                    Generate
                </button>
            </form>
        </div>
    </div>

    <!-- Save Preset Modal -->
    <div class="modal fade" id="savePresetModal" tabindex="-1" aria-labelledby="savePresetModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="savePresetModalLabel">Save Preset</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="preset-name" class="form-label">Preset Name:</label>
                        <input type="text" class="form-control" id="preset-name" v-model="presetName" placeholder="e.g., Hindi with Audio">
                    </div>
                    <div class="mb-3">
                        <label for="preset-description" class="form-label">Description (optional):</label>
                        <textarea class="form-control" id="preset-description" v-model="presetDescription" rows="2" placeholder="Brief description of this preset"></textarea>
                    </div>
                    <div class="alert alert-info" v-if="presetSaveMessage">
                        {{ presetSaveMessage }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" @click="savePreset">Save Preset</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- jQuery and Bootstrap Bundle JS -->
<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}" type="application/javascript"></script>
<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}" type="application/javascript"></script>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            targetAudio: false,
            sourceAudio: false,
            translation: false,
            overrideTranslation: false,
            anki: false,
            sentenceGeneration: false,
            imageGeneration: false,
            imageStyle: 'REALISTIC_CINEMATIC',
            front: '',
            back: '',
            presets: [],
            selectedPreset: '',
            presetName: '',
            presetDescription: '',
            presetSaveMessage: '',
            sourceLang: 'hi',
            targetLang: 'en',
            deck: ''
        },
        mounted: function() {
            this.loadPresets();
            this.checkForPresetConfig();
        },
        methods: {
            addFrontLineBreak: function () {
                this.front += "<br>\n";
            },
            addFrontSourceText: function () {
                this.front += "[source-text]\n";
            },
            addFrontSourceTransliteration: function () {
                this.front += "[source_transliteration]\n";
            },
            addFrontTargetText: function () {
                this.front += "[target-text]\n";
            },
            addFrontSourceAudio: function () {
                this.front += "[source-audio]\n";
            },
            addFrontTargetAudio: function () {
                this.front += "[target-audio]\n";
            },
            addBackLineBreak: function () {
                this.back += "<br>\n";
            },
            addBackSourceText: function () {
                this.back += "[source-text]\n";
            },
            addBackSourceTransliteration: function () {
                this.back += "[source_transliteration]\n";
            },
            addBackTargetText: function () {
                this.back += "[target-text]\n";
            },
            addBackSourceAudio: function () {
                this.back += "[source-audio]\n";
            },

            addBackTargetAudio: function () {
                this.back += "[target-audio]\n";
            },
            addFrontSentenceLatin: function () {
                this.front += "[sentence-latin]\n";
            },
            addFrontSentenceTarget: function () {
                this.front += "[sentence-target]\n";
            },
            addFrontSentenceTransliteration: function () {
                this.front += "[sentence-transliteration]\n";
            },
            addFrontSentenceSource: function () {
                this.front += "[sentence-source]\n";
            },
            addFrontSentenceStructure: function () {
                this.front += "[sentence-structure]\n";
            },
            addBackSentenceLatin: function () {
                this.back += "[sentence-latin]\n";
            },
            addBackSentenceTarget: function () {
                this.back += "[sentence-target]\n";
            },
            addBackSentenceTransliteration: function () {
                this.back += "[sentence-transliteration]\n";
            },
            addBackSentenceSource: function () {
                this.back += "[sentence-source]\n";
            },
            addBackSentenceStructure: function () {
                this.back += "[sentence-structure]\n";
            },
            addFrontSentenceSourceAudio: function () {
                this.front += "[sentence-source-audio]\n";
            },
            addBackSentenceSourceAudio: function () {
                this.back += "[sentence-source-audio]\n";
            },
            addFrontImage: function () {
                this.front += "[image]\n";
            },
            addBackImage: function () {
                this.back += "[image]\n";
            },
            addFrontMnemonicKeyword: function () {
                this.front += "[mnemonic_keyword]\n";
            },
            addBackMnemonicKeyword: function () {
                this.back += "[mnemonic_keyword]\n";
            },
            addFrontMnemonicSentence: function () {
                this.front += "[mnemonic_sentence]\n";
            },
            addBackMnemonicSentence: function () {
                this.back += "[mnemonic_sentence]\n";
            },
            setOptimalHindiCard: function () {
                // Set optimal front template
                this.front = "[source-text] ([sentence-latin])\n[source-audio]";

                // Set optimal back template
                this.back = "<br>\n[target-text]\n<br>\n[sentence-source]\n<br>\n[sentence-transliteration]\n<br>\n[sentence-target]\n<br>\n[sentence-structure]\n<br>\n[sentence-source-audio]";
            },
            loadPresets: function() {
                var self = this;
                fetch('/presets/api/all')
                    .then(response => response.json())
                    .then(data => {
                        self.presets = data;
                    })
                    .catch(error => {
                        console.error('Error loading presets:', error);
                    });
            },
            loadPreset: function() {
                if (!this.selectedPreset) return;

                var self = this;
                var preset = this.presets.find(p => p.id == this.selectedPreset);
                if (!preset) return;

                // Update form fields based on preset (v-model will update the DOM automatically)
                this.sourceLang = preset.sourceLanguage || 'hi';
                this.targetLang = preset.targetLanguage || 'en';
                this.sourceAudio = !!preset.enableSourceAudio;
                this.targetAudio = !!preset.enableTargetAudio;
                this.translation = preset.enableTranslation !== false;
                this.sentenceGeneration = !!preset.enableSentenceGeneration;
                this.imageGeneration = !!preset.enableImageGeneration;
                this.imageStyle = preset.imageStyle || 'REALISTIC_CINEMATIC';
                this.anki = !!preset.ankiEnabled;
                this.deck = preset.ankiDeck || '';
                this.front = preset.ankiFrontTemplate || '';
                this.back = preset.ankiBackTemplate || '';
            },
            showSavePresetModal: function() {
                this.presetName = '';
                this.presetDescription = '';
                this.presetSaveMessage = '';
                var modal = new bootstrap.Modal(document.getElementById('savePresetModal'));
                modal.show();
            },
            savePreset: function() {
                var self = this;

                if (!this.presetName || this.presetName.trim() === '') {
                    this.presetSaveMessage = 'Please enter a preset name';
                    return;
                }

                var presetData = {
                    presetName: this.presetName,
                    description: this.presetDescription,
                    sourceLanguage: this.sourceLang,
                    targetLanguage: this.targetLang,
                    enableSourceAudio: this.sourceAudio,
                    enableTargetAudio: this.targetAudio,
                    enableTranslation: this.translation,
                    enableSentenceGeneration: this.sentenceGeneration,
                    enableImageGeneration: this.imageGeneration,
                    imageStyle: this.imageStyle,
                    ankiEnabled: this.anki,
                    ankiDeck: this.deck,
                    ankiFrontTemplate: this.front,
                    ankiBackTemplate: this.back
                };

                console.log('Saving preset with data:', presetData);
                console.log('imageGeneration value:', this.imageGeneration);

                fetch('/presets/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(presetData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        self.presetSaveMessage = data.message;
                        self.loadPresets();
                        setTimeout(function() {
                            var modal = bootstrap.Modal.getInstance(document.getElementById('savePresetModal'));
                            modal.hide();
                        }, 1500);
                    } else {
                        self.presetSaveMessage = 'Error: ' + data.error;
                    }
                })
                .catch(error => {
                    self.presetSaveMessage = 'Error saving preset: ' + error;
                });
            },
            checkForPresetConfig: function() {
                // Check if there's a preset config in sessionStorage (from "Generate with same preset")
                const presetConfigStr = sessionStorage.getItem('loadPresetConfig');
                if (presetConfigStr) {
                    try {
                        const presetConfig = JSON.parse(presetConfigStr);

                        // Load the configuration into the form (v-model will update the DOM automatically)
                        this.sourceLang = presetConfig.sourceLanguage || 'hi';
                        this.targetLang = presetConfig.targetLanguage || 'en';
                        this.sourceAudio = !!presetConfig.enableSourceAudio;
                        this.targetAudio = !!presetConfig.enableTargetAudio;
                        this.translation = presetConfig.enableTranslation !== false;
                        this.sentenceGeneration = !!presetConfig.enableSentenceGeneration;
                        this.imageGeneration = !!presetConfig.enableImageGeneration;
                        this.imageStyle = presetConfig.imageStyle || 'REALISTIC_CINEMATIC';
                        this.anki = !!presetConfig.ankiEnabled;
                        this.deck = presetConfig.ankiDeck || '';
                        this.front = presetConfig.ankiFrontTemplate || '';
                        this.back = presetConfig.ankiBackTemplate || '';

                        // Clear the sessionStorage
                        sessionStorage.removeItem('loadPresetConfig');
                    } catch (e) {
                        console.error('Error loading preset config:', e);
                    }
                }
            }
        }
    })
</script>
</body>
</html>
