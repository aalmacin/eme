<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Generation Presets - Eme</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">

    <style>
        body {
            background-color: #f8f9fa;
        }

        h1, h2 {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 600;
        }

        .nav-links {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .nav-links a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .nav-links a:hover {
            background-color: #e9ecef;
        }

        .preset-card {
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }

        .preset-card.default {
            border-left: 4px solid #28a745;
        }

        .preset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preset-title {
            font-size: 20px;
            font-weight: bold;
        }

        .default-badge {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: 10px;
        }

        .usage-badge {
            background: #6c757d;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: 10px;
        }

        .preset-info {
            margin-bottom: 10px;
            color: #6c757d;
            font-size: 14px;
        }

        .preset-actions {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .config-item {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
        }

        .config-item strong {
            color: #495057;
        }

        .feature-enabled {
            color: #28a745;
            font-weight: bold;
        }

        .feature-disabled {
            color: #dc3545;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Generation Presets</h1>

    <div class="nav-links">
        <a href="/">‚Üê Back to Home</a>
        <a href="/words">üìñ Words Library</a>
        <a href="/sessions">üì¶ Translation Sessions</a>
        <a href="/character-guide">üé≠ Character Guide</a>
        <a href="/anki-formats">üé¥ Anki Card Formats</a>
    </div>

    <div th:if="${#lists.isEmpty(presets)}" class="alert alert-info">
        <h4>No presets found</h4>
        <p>You haven't created any presets yet. Go to the home page and use "Save Current Settings as Preset" to create your first preset.</p>
        <a href="/" class="btn btn-primary">Go to Home Page</a>
    </div>

    <div th:each="preset : ${presets}" th:class="${preset.isDefault ? 'preset-card default' : 'preset-card'}">
        <div class="preset-header">
            <div>
                <span class="preset-title" th:text="${preset.presetName}"></span>
                <span th:if="${preset.isDefault}" class="default-badge">Default</span>
                <span class="usage-badge" th:text="'Used ' + ${preset.usageCount} + ' times'"></span>
            </div>
        </div>

        <div class="preset-info" th:if="${preset.description != null && !preset.description.isEmpty()}">
            <strong>Description:</strong> <span th:text="${preset.description}"></span>
        </div>

        <div class="config-grid">
            <div class="config-item">
                <strong>Source:</strong> <span th:text="${preset.sourceLanguage}"></span>
            </div>
            <div class="config-item">
                <strong>Target:</strong> <span th:text="${preset.targetLanguage}"></span>
            </div>
            <div class="config-item">
                <strong>Source Audio:</strong>
                <span th:class="${preset.enableSourceAudio ? 'feature-enabled' : 'feature-disabled'}"
                      th:text="${preset.enableSourceAudio ? 'Enabled' : 'Disabled'}"></span>
            </div>
            <div class="config-item">
                <strong>Target Audio:</strong>
                <span th:class="${preset.enableTargetAudio ? 'feature-enabled' : 'feature-disabled'}"
                      th:text="${preset.enableTargetAudio ? 'Enabled' : 'Disabled'}"></span>
            </div>
            <div class="config-item">
                <strong>Translation:</strong>
                <span th:class="${preset.enableTranslation ? 'feature-enabled' : 'feature-disabled'}"
                      th:text="${preset.enableTranslation ? 'Enabled' : 'Disabled'}"></span>
            </div>
            <div class="config-item">
                <strong>Sentence Gen:</strong>
                <span th:class="${preset.enableSentenceGeneration ? 'feature-enabled' : 'feature-disabled'}"
                      th:text="${preset.enableSentenceGeneration ? 'Enabled' : 'Disabled'}"></span>
            </div>
            <div class="config-item">
                <strong>Image Gen:</strong>
                <span th:class="${preset.enableImageGeneration ? 'feature-enabled' : 'feature-disabled'}"
                      th:text="${preset.enableImageGeneration ? 'Enabled' : 'Disabled'}"></span>
            </div>
            <div class="config-item" th:if="${preset.ankiEnabled}">
                <strong>Anki Deck:</strong> <span th:text="${preset.ankiDeck}"></span>
            </div>
        </div>

        <div class="preset-actions">
            <button type="button" class="btn btn-sm btn-outline-success" th:if="${!preset.isDefault}"
                    th:data-preset-id="${preset.id}"
                    onclick="setAsDefault(this.dataset.presetId)">
                ‚≠ê Set as Default
            </button>
            <button type="button" class="btn btn-sm btn-outline-danger"
                    th:data-preset-id="${preset.id}"
                    th:data-preset-name="${preset.presetName}"
                    onclick="deletePreset(this.dataset.presetId, this.dataset.presetName)">
                üóëÔ∏è Delete
            </button>
            <span style="font-size: 12px; color: #6c757d; margin-left: 15px;">
                Created: <span th:text="${#temporals.format(preset.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                | Updated: <span th:text="${#temporals.format(preset.updatedAt, 'yyyy-MM-dd HH:mm')}"></span>
            </span>
        </div>
    </div>
</div>

<!-- jQuery and Bootstrap Bundle JS -->
<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}" type="application/javascript"></script>
<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}" type="application/javascript"></script>

<script>
    function setAsDefault(presetId) {
        if (confirm('Set this preset as the default?')) {
            fetch(`/presets/${presetId}/set-default`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
    }

    function deletePreset(presetId, presetName) {
        if (confirm(`Are you sure you want to delete the preset "${presetName}"?`)) {
            fetch(`/presets/${presetId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
    }
</script>
</body>
</html>
