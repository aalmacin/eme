<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Review Words - Eme</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">

    <!-- Include Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
        }

        h1, h2, h3, h4 {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 600;
        }

        .card {
            border: none;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .card-header {
            background-color: #ffffff;
            border-bottom: none;
        }

        .card-body {
            background-color: #ffffff;
        }

        .card-title {
            margin-bottom: 0;
        }

        .word-row {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .word-row:last-child {
            border-bottom: none;
        }

        .word-display {
            font-size: 1.2rem;
            font-weight: 600;
            color: #212529;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .nav-links {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .nav-links a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .nav-links a:hover {
            background-color: #e9ecef;
        }

        .info-badge {
            background-color: #0d6efd;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-right: 8px;
        }
    </style>
</head>

<body>
<div class="container mt-5" id="app">
    <h1 class="mb-4">Review Words Before Generation</h1>

    <div class="nav-links">
        <a href="/">Back to Home</a>
        <a href="/words">Words Library</a>
        <a href="/sessions">Translation Sessions</a>
    </div>

    <!-- Language Information -->
    <div class="card shadow mb-3">
        <div class="card-header">
            <h2 class="card-title h5">Language Configuration</h2>
        </div>
        <div class="card-body">
            <p>
                <span class="info-badge">Source</span>
                <strong th:text="${sourceLanguageName}">Source Language</strong>
                <span th:text="'(' + ${sourceLang} + ')'"></span>
            </p>
            <p>
                <span class="info-badge">Target</span>
                <strong th:text="${targetLanguageName}">Target Language</strong>
                <span th:text="'(' + ${targetLang} + ')'"></span>
            </p>
        </div>
    </div>

    <!-- Review Form -->
    <form th:action="@{/generate/confirm}" method="post">
        <!-- Hidden fields for configuration -->
        <input type="hidden" name="targetLang" th:value="${targetLang}" />
        <input type="hidden" name="front" th:value="${front}" />
        <input type="hidden" name="back" th:value="${back}" />
        <input type="hidden" name="deck" th:value="${deck}" />
        <input type="hidden" name="translation" th:value="${translation}" />
        <input type="hidden" name="override-translation" th:value="${overrideTranslation}" />
        <input type="hidden" name="source-audio" th:value="${sourceAudio}" />
        <input type="hidden" name="target-audio" th:value="${targetAudio}" />
        <input type="hidden" name="anki" th:value="${anki}" />
        <input type="hidden" name="sentence-generation" th:value="${sentenceGeneration}" />
        <input type="hidden" name="image-generation" th:value="${imageGeneration}" />
        <input type="hidden" name="image-style" th:value="${imageStyle}" />

        <!-- Words Review Card -->
        <div class="card shadow">
            <div class="card-header">
                <h2 class="card-title h5">Review and Edit Words</h2>
                <small class="text-muted">
                    Update mnemonic keywords, translations, and source languages as needed.
                    Changes will be saved with manual override timestamps.
                </small>
            </div>
            <div class="card-body">
                <div th:each="word, iterStat : ${reviewWords}" class="word-row">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <label class="form-label">Word (Read-only)</label>
                            <div class="word-display" th:text="${word.word}">Word</div>
                            <input type="hidden" name="words" th:value="${word.word}" />
                        </div>

                        <div class="col-md-3">
                            <label th:for="'sourceLang-' + ${iterStat.index}" class="form-label">Source Language</label>
                            <select class="form-select" th:id="'sourceLang-' + ${iterStat.index}" name="sourceLanguages">
                                <option value="cafr" th:selected="${word.sourceLanguage == 'cafr'}">Canadian French</option>
                                <option value="jp" th:selected="${word.sourceLanguage == 'jp'}">Japanese</option>
                                <option value="kr" th:selected="${word.sourceLanguage == 'kr'}">Korean</option>
                                <option value="es" th:selected="${word.sourceLanguage == 'es'}">Spanish</option>
                                <option value="fr" th:selected="${word.sourceLanguage == 'fr'}">French</option>
                                <option value="en" th:selected="${word.sourceLanguage == 'en'}">English</option>
                                <option value="hi" th:selected="${word.sourceLanguage == 'hi'}">Hindi</option>
                                <option value="pa" th:selected="${word.sourceLanguage == 'pa'}">Punjabi</option>
                                <option value="tl" th:selected="${word.sourceLanguage == 'tl'}">Tagalog</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label th:for="'mnemonic-' + ${iterStat.index}" class="form-label">Mnemonic Keyword</label>
                            <input type="text"
                                   class="form-control"
                                   th:id="'mnemonic-' + ${iterStat.index}"
                                   name="mnemonicKeywords"
                                   th:value="${word.mnemonicKeyword}"
                                   placeholder="Enter mnemonic keyword" />
                            <small class="form-text text-muted">Will set manual override timestamp if changed</small>
                        </div>

                        <div class="col-md-3">
                            <label th:for="'translation-' + ${iterStat.index}" class="form-label">Translation</label>
                            <input type="text"
                                   class="form-control"
                                   th:id="'translation-' + ${iterStat.index}"
                                   name="translations"
                                   th:value="${word.translation}"
                                   placeholder="Enter translation (comma-separated)" />
                            <small class="form-text text-muted">Will set manual override timestamp if changed</small>
                        </div>
                    </div>

                    <!-- Character and Transliteration Info -->
                    <div class="row mt-2" th:if="${word.transliteration != null || word.characterName != null}">
                        <div class="col-md-12">
                            <div style="background-color: #f0f8ff; padding: 10px; border-radius: 4px; border-left: 3px solid #0d6efd;">
                                <small>
                                    <span th:if="${word.transliteration != null}">
                                        <strong>Transliteration:</strong> <span th:text="${word.transliteration}"></span>
                                    </span>
                                    <span th:if="${word.characterName != null}" style="margin-left: 15px;">
                                        <strong>Character:</strong>
                                        <span th:text="${word.characterName}"></span>
                                        <span th:if="${word.characterContext != null}">
                                            from <em th:text="${word.characterContext}"></em>
                                        </span>
                                        <span style="color: #28a745; margin-left: 5px;">âœ“</span>
                                    </span>
                                    <span th:if="${word.transliteration != null && word.characterName == null}" style="margin-left: 15px; color: #666;">
                                        <strong>Character:</strong> <em>Will be auto-selected based on sound</em>
                                    </span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row mt-4 mb-5">
            <div class="col-md-6">
                <a href="/" class="btn btn-secondary btn-lg w-100">Cancel</a>
            </div>
            <div class="col-md-6">
                <button type="submit" class="btn btn-primary btn-lg w-100">
                    Confirm and Generate
                </button>
            </div>
        </div>
    </form>
</div>

<!-- jQuery and Bootstrap Bundle JS -->
<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}" type="application/javascript"></script>
<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}" type="application/javascript"></script>
</body>
</html>
