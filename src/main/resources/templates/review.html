<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Review Words - EME</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <nav class="navbar is-primary" role="navigation">
        <div class="container">
            <div class="navbar-brand">
                <a class="navbar-item has-text-weight-bold is-size-5" th:href="@{/}">
                    <span class="icon mr-2"><i class="fas fa-language"></i></span>
                    <span>EME</span>
                </a>
            </div>
            <div class="navbar-menu">
                <div class="navbar-start">
                    <a class="navbar-item" th:href="@{/}">Home</a>
                    <a class="navbar-item" th:href="@{/words}">Words</a>
                    <a class="navbar-item" th:href="@{/translations}">Translations</a>
                    <a class="navbar-item" th:href="@{/sentences}">Sentences</a>
                    <a class="navbar-item" th:href="@{/character-guide}">Characters</a>
                    <a class="navbar-item" th:href="@{/sessions}">Sessions</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="eme-main">
        <div class="container">
            <h1 class="title is-3 mb-5">
                <span class="icon mr-2"><i class="fas fa-check-double"></i></span>
                Review Words Before Generation
            </h1>

            <div class="box mb-4">
                <nav class="breadcrumb" aria-label="breadcrumbs">
                    <ul>
                        <li><a th:href="@{/}">Home</a></li>
                        <li><a th:href="@{/words}">Words Library</a></li>
                        <li><a th:href="@{/sessions}">Translation Sessions</a></li>
                        <li class="is-active"><a href="#" aria-current="page">Review</a></li>
                    </ul>
                </nav>
            </div>

            <!-- Language Information -->
            <div class="box mb-4">
                <h2 class="title is-5">
                    <span class="icon mr-2"><i class="fas fa-cog"></i></span>
                    Language Configuration
                </h2>
                <div class="columns">
                    <div class="column">
                        <div class="notification is-light">
                            <span class="tag is-info mr-2">Source</span>
                            <strong th:text="${sourceLanguageName}">Source Language</strong>
                            <span class="text-secondary" th:text="'(' + ${sourceLang} + ')'"></span>
                        </div>
                    </div>
                    <div class="column">
                        <div class="notification is-light">
                            <span class="tag is-success mr-2">Target</span>
                            <strong th:text="${targetLanguageName}">Target Language</strong>
                            <span class="text-secondary" th:text="'(' + ${targetLang} + ')'"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Form -->
            <form th:action="@{/generate/confirm}" method="post">
                <!-- Hidden fields for configuration -->
                <input type="hidden" name="targetLang" th:value="${targetLang}" />
                <input type="hidden" name="ankiFormatId" th:value="${ankiFormatId}" />
                <input type="hidden" name="deck" th:value="${deck}" />
                <input type="hidden" name="translation" th:value="${translation}" />
                <input type="hidden" name="override-translation" th:value="${overrideTranslation}" />
                <input type="hidden" name="source-audio" th:value="${sourceAudio}" />
                <input type="hidden" name="target-audio" th:value="${targetAudio}" />
                <input type="hidden" name="anki" th:value="${anki}" />
                <input type="hidden" name="sentence-generation" th:value="${sentenceGeneration}" />
                <input type="hidden" name="image-generation" th:value="${imageGeneration}" />
                <input type="hidden" name="image-style" th:value="${imageStyle}" />

                <!-- Words Review Card -->
                <div class="box mb-5">
                    <h2 class="title is-5">
                        <span class="icon mr-2"><i class="fas fa-edit"></i></span>
                        Review and Edit Words
                    </h2>
                    <p class="has-text-grey mb-4">
                        Update mnemonic keywords, translations, and source languages as needed.
                        Changes will be saved with manual override timestamps.
                    </p>

                    <div th:each="word, iterStat : ${reviewWords}" class="box mb-3 has-background-light">
                        <div class="columns is-multiline is-align-items-end">
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label is-small">Word (Read-only)</label>
                                    <div class="notification is-white py-2 px-3 has-text-weight-bold is-size-5" th:text="${word.word}">Word</div>
                                    <input type="hidden" name="words" th:value="${word.word}" />
                                </div>
                            </div>

                            <div class="column is-3">
                                <div class="field">
                                    <label th:for="'sourceLang-' + ${iterStat.index}" class="label is-small">Source Language</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            <select th:id="'sourceLang-' + ${iterStat.index}" name="sourceLanguages">
                                                <option value="cafr" th:selected="${word.sourceLanguage == 'cafr'}">Canadian French</option>
                                                <option value="jp" th:selected="${word.sourceLanguage == 'jp'}">Japanese</option>
                                                <option value="kr" th:selected="${word.sourceLanguage == 'kr'}">Korean</option>
                                                <option value="es" th:selected="${word.sourceLanguage == 'es'}">Spanish</option>
                                                <option value="fr" th:selected="${word.sourceLanguage == 'fr'}">French</option>
                                                <option value="en" th:selected="${word.sourceLanguage == 'en'}">English</option>
                                                <option value="hi" th:selected="${word.sourceLanguage == 'hi'}">Hindi</option>
                                                <option value="pa" th:selected="${word.sourceLanguage == 'pa'}">Punjabi</option>
                                                <option value="tl" th:selected="${word.sourceLanguage == 'tl'}">Tagalog</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="column is-3">
                                <div class="field">
                                    <label th:for="'mnemonic-' + ${iterStat.index}" class="label is-small">Mnemonic Keyword</label>
                                    <div class="control">
                                        <input type="text"
                                               class="input"
                                               th:id="'mnemonic-' + ${iterStat.index}"
                                               name="mnemonicKeywords"
                                               th:value="${word.mnemonicKeyword}"
                                               placeholder="Enter mnemonic keyword" />
                                    </div>
                                    <p class="help">Will set manual override timestamp if changed</p>
                                </div>
                            </div>

                            <div class="column is-3">
                                <div class="field">
                                    <label th:for="'translation-' + ${iterStat.index}" class="label is-small">Translation</label>
                                    <div class="control">
                                        <input type="text"
                                               class="input"
                                               th:id="'translation-' + ${iterStat.index}"
                                               name="translations"
                                               th:value="${word.translation}"
                                               placeholder="Enter translation (comma-separated)" />
                                    </div>
                                    <p class="help">Will set manual override timestamp if changed</p>
                                </div>
                            </div>
                        </div>

                        <!-- Character and Transliteration Info -->
                        <div th:if="${word.transliteration != null || word.characterName != null}" class="mt-2">
                            <div class="notification is-info is-light py-2 px-3">
                                <span th:if="${word.transliteration != null}" class="mr-4">
                                    <strong>Transliteration:</strong> <span th:text="${word.transliteration}"></span>
                                </span>
                                <span th:if="${word.characterName != null}">
                                    <strong>Character:</strong>
                                    <span th:text="${word.characterName}"></span>
                                    <span th:if="${word.characterContext != null}">
                                        from <em th:text="${word.characterContext}"></em>
                                    </span>
                                    <span class="has-text-success ml-1">&#10003;</span>
                                </span>
                                <span th:if="${word.transliteration != null && word.characterName == null}" class="text-secondary">
                                    <strong>Character:</strong> <em>Will be auto-selected based on sound</em>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="columns mb-5">
                    <div class="column is-6">
                        <a th:href="@{/}" class="button is-light is-large is-fullwidth">
                            <span class="icon"><i class="fas fa-times"></i></span>
                            <span>Cancel</span>
                        </a>
                    </div>
                    <div class="column is-6">
                        <button type="submit" class="button is-primary is-large is-fullwidth">
                            <span class="icon"><i class="fas fa-check"></i></span>
                            <span>Confirm and Generate</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </main>
</body>
</html>
